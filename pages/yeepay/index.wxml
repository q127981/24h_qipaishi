<!-- pages/merchant/index.wxml -->
<view class="page">
  <!-- 顶部账户信息：iOS 风卡片 -->
  <view class="account-card">
    <view class="header">
      <view class="left">
        <view class="title">申请状态：{{status == 0 ? '待提交' : status == 1 ? '审核中' : status == 2 ? '审核不通过' : status == 3 ? '待实名' : status == 4 ? '已开通' : '待整改'}}</view>
        <view class="remark" wx:if="{{status!=4}}">{{remark}}</view>
      </view>
      <view class="status" wx:if="{{status === 4 || status === 5}}">
        <view class="mchId">易宝商户号:{{mchId}}</view>
        <text  class="copy" bindtap="copyMchId">复制</text>
      </view>
      <view class="tip" wx:if="{{status === 4}}">
        查看资金记录，用“易宝支付”微信小程序，或应用市场下载“老板管账商户版”App，使用商户号进行登陆！
      </view>
    </view>
    <view wx:if="{{status === 3}}" class="qr-wrap">
      <image src="{{shimingCode}}" mode="scaleToFill" class="qr"/>
      <text class="qr-tip">请使用支付宝和微信扫码，分别完成实名认证</text>
    </view>
  </view>

  <!-- 可编辑表单 -->
  <view class="form-card" wx:if="{{ !status || status === 2 || status === 5}}">
    <form bindsubmit="submit">
      <view class="hidden" value=""></view>
      <!-- 一行字段 -->
      <view class="field-row">
        <text class="label">真实姓名*</text>
        <input name="legalName" value="{{legalName}}" class="input" placeholder="请输入真实姓名"/>
      </view>
      <view class="field-row">
        <text class="label">手机号*</text>
        <input name="phone" value="{{phone}}" type="number" maxlength="11" class="input" placeholder="本人实名手机号"/>
      </view>
      <view class="field-row">
        <text class="label">身份证号*</text>
        <input name="idCard" value="{{idCard}}" maxlength="18" bindinput="onIdCardInput" class="input" placeholder="身份证号"/>
      </view>
      <text wx:if="{{idCardErr}}" class="err">{{idCardErr}}</text>
      <view class="section-title">身份证照片</view>
      <view class="img-row">
        <view class="img-box" bindtap="choose" data-key="idCardFront">
          <image wx:if="{{idCardFront}}" src="{{idCardFront}}" mode="scaleToFill"/>
          <text wx:else>身份证人像面 *</text>
        </view>
        <view class="img-box" bindtap="choose" data-key="idCardBack">
          <image wx:if="{{idCardBack}}" src="{{idCardBack}}" mode="scaleToFill"/>
          <text wx:else>身份证国徽面 *</text>
        </view>
      </view>

      <view class="field-row">
        <text class="label">店铺简称*</text>
        <input name="shopName" value="{{shopName}}" class="input" placeholder="请输入3-16个字的简称"/>
      </view>

      <view class="field-row">
        <text class="label">所在城市*</text>
        <picker mode="region" value="{{regionValue}}" bindchange="regionChange">
          <text class="picker-text">{{regionText || '请选择'}}</text>
        </picker>
      </view>

      <view class="field-row">
        <text class="label">详细地址*</text>
        <input name="address" value="{{address}}" class="input"/>
      </view>
      <view class="tip">请务必填写真实的地址信息，否则可能会被风控</view>
      <!-- 图片上传 -->
      <view class="section-title">店铺经营照片</view>
      <view class="img-row">
        <view class="img-box" bindtap="choose" data-key="storeFront">
          <image wx:if="{{storeFront}}" src="{{storeFront}}" mode="scaleToFill"/>
          <text wx:else>店铺门头/招牌 *</text>
        </view>
        <view class="img-box" bindtap="choose" data-key="scene">
          <image wx:if="{{scene}}" src="{{scene}}" mode="scaleToFill"/>
          <text wx:else>店铺经营场景 *</text>
        </view>
      </view>
      <view class="tip">店铺经营场景为店内实拍照片，可以是收银台、消费的房间、商品陈列柜等，能体现经营的内容。如果不方便拍摄，可以用“豆包”辅助生成照片。银行要求必须上传</view>
      <view class="section-title">银行收款信息</view>
      <!-- 银行信息 -->
      <view class="field-row">
        <text class="label">开户银行*</text>
        <view class="bank-search" bindtap="toggleBankPicker">
          <text class="picker-text">{{bankName || '请选择银行'}}</text>
        </view>
      </view>

      <!-- 银行搜索弹窗 -->
      <view class="bank-modal {{showBank ? 'show' : ''}}" catchtouchmove="true">
        <view class="bank-mask" bindtap="toggleBankPicker"/>
        <view class="bank-body">
          <view class="bank-header">
            <input placeholder="搜索银行" bindinput="onBankSearch" class="search-input"/>
            <text class="close" bindtap="toggleBankPicker">✕</text>
          </view>
          <scroll-view scroll-y class="bank-list">
            <block wx:for="{{bankList}}" wx:key="code">
              <view class="bank-item" bindtap="selectBank" data-item="{{item}}">{{item.name}}</view>
            </block>
          </scroll-view>
        </view>
      </view>

      <view class="field-row">
        <text class="label">银行卡号*</text>
        <input name="bankCard" value="{{bankCard}}" type="number" class="input" placeholder="输入本人实名的银行卡号码"/>
      </view>
      <view class="tip">仅支持储蓄卡，不支持信用卡！</view>
      <input type="hidden" style="display: none;" value="{{id}}"></input>
      <input type="hidden" style="display: none;" value="{{requestNo}}"></input>
      <input type="hidden" style="display: none;" value="{{fullAddress}}"></input>
      <button form-type="submit" class="btn">提交申请</button>
    </form>
  </view>

  <!-- 只读卡片：状态=1/3/4 -->
  <view class="readonly-card" wx:else>
    <view class="readonly-row"><text class="label">真实姓名</text><text class="value">{{legalName}}</text></view>
    <view class="readonly-row"><text class="label">手机号</text><text class="value">{{phone}}</text></view>
    <view class="readonly-row"><text class="label">店铺简称</text><text class="value">{{shopName}}</text></view>
    <view class="readonly-row"><text class="label">经营地址</text><text class="value">{{fullAddress}}</text></view>
    <view class="readonly-row"><text class="label">详细地址</text><text class="value">{{address}}</text></view>
    <view class="readonly-row"><text class="label">开户银行</text><text class="value">{{bankName}}</text></view>
    <view class="readonly-row"><text class="label">银行卡号</text><text class="value">{{bankCard}}</text></view>
  </view>
</view>


<!-- 用户使用需知弹框 -->
<view wx:if="{{showUserConsent}}" class="mask" catchtouchmove="true">
  <view class="modal">
    <view class="modal-title">用户使用需知</view>
    <view class="modal-content">
      使用本服务前，请先仔细阅读
      <text class="link" bindtap="openAgreement" data-type="service">《用户服务协议》</text>及
      <text class="link" bindtap="openAgreement" data-type="privacy">《隐私政策》</text>。
    </view>
    <view class="modal-footer">
      <button class="btn-cancel" bindtap="onCancelConsent">暂不使用</button>
      <button class="btn-confirm" bindtap="onAgreeConsent">同意</button>
    </view>
  </view>
</view>