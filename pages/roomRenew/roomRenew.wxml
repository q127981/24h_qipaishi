<wxs src="../../utils/magic.wxs" module="magic" />
<view class="container">
  <view class="roomName">{{roominfodata.roomName}}</view>
  <!-- é¡¶éƒ¨åŒæŒ‰é’® -->
  <view class="top-actions">
    <view class="action-btn renew-btn" bind:tap="renewClick">
      <view class="btn-icon">â±ï¸</view>
      <view class="btn-text">è®¢å•ç»­è´¹</view>
      <view class="btn-desc">å»¶é•¿ä½¿ç”¨æ—¶é—´</view>
    </view>
    <view class="action-btn shop-btn" bind:tap="goShop">
      <view class="btn-icon">ğŸ›ï¸</view>
      <view class="btn-text">å•†å“ç‚¹å•</view>
      <view class="btn-desc">é›¶é£Ÿé¥®æ–™é€åˆ°æˆ¿</view>
    </view>
  </view>
<!-- ç©ºçŠ¶æ€ - å½“ OrderInfodata ä¸ºç©ºæ—¶æ˜¾ç¤º -->
<view class="empty-state" wx:if="{{!OrderInfodata}}" bind:tap="gotoSubmit">
  <view class="empty-icon">
    <image src="../static/icon/empty-order.png" mode="aspectFit" wx:if="{{false}}" />
    <text class="icon-text">ğŸ“‹</text>
  </view>
  <view class="empty-title">æš‚æ— è¿›è¡Œä¸­çš„è®¢å•</view>
  <view class="empty-desc">å½“å‰åœºåœ°æ²¡æœ‰æ­£åœ¨è¿›è¡Œçš„è®¢å•</view>
  <view class="empty-action">
    <text>å»ä¸‹å•</text>
    <text class="arrow">â€º</text>
  </view>
</view>
  <!-- è®¢å•ä¿¡æ¯åŒºåŸŸ -->
  <view class="order-section" wx:if="{{OrderInfodata}}">
    <!-- æ—¶é—´æ®µ -->
    <view class="timeBox">
      <view class="time">
        <view class="hour">
          <image src="../static/icon/time-start.png" />
          {{magic.splittime(OrderInfodata.startTime)[0]}}:{{magic.splittime(OrderInfodata.startTime)[1]}}
        </view>
        <view class="date">{{magic.splitkongge(OrderInfodata.startTime)[0]}}</view>
      </view>
      <view wx:if="{{OrderInfodata.endTime}}" class="total border-primary">å…±{{OrderInfodata.orderHour}}å°æ—¶</view>
      <view class="time" wx:if="{{OrderInfodata.endTime}}">
        <view class="hour">
          {{magic.splittime(OrderInfodata.endTime)[0]}}:{{magic.splittime(OrderInfodata.endTime)[1]}}
          <image src="../static/icon/time-end.png" />
        </view>
        <view class="date">{{magic.splitkongge(OrderInfodata.endTime)[0]}}</view>
      </view>
      <view class="no-end" style="font-weight: 300;" wx:if="{{!OrderInfodata.endTime}}">è‡³</view>
      <view class="no-end" wx:if="{{!OrderInfodata.endTime}}">ä¸»åŠ¨ç¦»åº—</view>
    </view>

    <!-- è®¢å•è¯¦æƒ… -->
    <view class="orderInfo">
      <view class="top">
        <view class="tag">{{['æœªçŸ¥','å°åŒ…', 'ä¸­åŒ…', 'å¤§åŒ…', 'è±ªåŒ…', 'å•†åŠ¡åŒ…','æ–¯æ´›å…‹','ä¸­å¼é»‘å…«','ç¾å¼çƒæ¡Œ'][OrderInfodata.roomType]}}</view>
        <text>{{OrderInfodata.roomName}}</text>
      </view>
      <view class="name">{{OrderInfodata.storeName}}</view>
      <view class="address">
        <view class="left">{{OrderInfodata.address}}</view>
        <view class="right">
          <view class="item" bind:tap="onClickShow" data-index="0">
            <image src="../static/icon/navigation.png" />
            <text>å¯¼èˆª</text>
          </view>
          <view class="line"></view>
          <view class="item" bind:tap="onClickShow" data-index="1">
            <image src="../static/icon/phone.png" />
            <text>ç”µè¯</text>
          </view>
        </view>
      </view>
      <view class="info-line">
        <text class="bold">ä¸‹å•æ—¶é—´ï¼š</text>
        <text>{{OrderInfodata.createTime}}</text>
      </view>
      <view class="info-line" bind:tap="copyOrderNo" data-order="{{OrderInfodata.orderNo}}">
        <text class="bold">è®¢å•ç¼–å·ï¼š</text>
        <text>{{OrderInfodata.orderNo}}</text>
        <view class="copy">å¤åˆ¶</view>
      </view>
      <view class="info-line display-space">
        <view>
          <text class="bold">æ”¯ä»˜æ–¹å¼ï¼š</text>
          <text>{{OrderInfodata.payType===0?'ç®¡ç†å‘˜':OrderInfodata.payType===1?'å¾®ä¿¡':OrderInfodata.payType===2?'ä½™é¢':OrderInfodata.payType===3?'å›¢è´­':OrderInfodata.payType===4?'å¥—é¤':'é¢„è®¢'}}</text>
        </view>
        <text style="text-decoration-line: underline;font-size: 26rpx;" class="right" wx:if="{{OrderInfodata.status === 0}}" bindtap="cancelOrder" data-info="{{OrderInfodata.status}}">ç”³è¯·é€€æ¬¾</text>
      </view>
      <view class="info-line">
        <text class="bold">è®¢å•çŠ¶æ€ï¼š</text>
        <text>{{['å¾…æ¶ˆè´¹', 'æ¶ˆè´¹ä¸­', 'å·²å®Œæˆ', 'å·²é€€æ¬¾'][OrderInfodata.status]}}</text>
      </view>
      <view class="info-line">
        <text class="bold">è®¢å•æ€»ä»·ï¼š</text>
        <text>Â¥ {{OrderInfodata.price}}</text>
      </view>
      <view class="info-line">
        <text class="bold">è®¢å•æŠ¼é‡‘ï¼š</text>
        <text>Â¥ {{OrderInfodata.deposit}}</text>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨è¿”å› -->
  <view class="bottom-action">
    <button class="back-btn" bind:tap="backHome">è¿”å›é—¨åº—</button>
  </view>
</view>

<!-- å¯¼èˆª/ç”µè¯å¼¹çª— - ä¿æŒåŸå§‹ -->
<van-overlay show="{{ show }}" bind:click="onClickHide">
  <view class="popup navigation" wx:if="{{popupIndex === 0}}">
    <view class="title">å¯¼èˆªåˆ°åº—</view>
    <view class="sub-title">å¯é€‰æ‹©æ‚¨æ‰€éœ€è¦çš„æœåŠ¡</view>
    <view class="btn" bind:tap="goTencentMap">
      <image src="../static/icon/nav.png" />
      åœ°å›¾å¯¼èˆª
    </view>
    <view class="btn" bind:tap="goGuide">
      <image src="../static/icon/guide.png" />
      ä½ç½®æŒ‡å¼•
    </view>
  </view>
  <view class="popup service" wx:if="{{popupIndex === 1}}">
    <view class="title">è”ç³»å®¢æœ</view>
    <view class="sub-title">å¯é€‰æ‹©æ‚¨æ‰€éœ€è¦çš„æœåŠ¡</view>
    <view class="btn" bind:tap="call">
      <image src="../static/icon/phone-call.png" />
      {{ OrderInfodata.kefuPhone }}
    </view>
    <view class="btn" bind:tap="copy" wx:if="{{OrderInfodata.kefuWx}}">
      <image src="../static/icon/wechat.png" />
      {{OrderInfodata.kefuWx}}
    </view>
  </view>
</van-overlay>

<!-- è®¢å•ç»­è´¹å¼¹çª— - å®Œå…¨ä¿æŒåŸå§‹ä»£ç ä¸å˜ -->
<van-popup show="{{ renewShow }}" position="bottom" custom-style="height: 74%; border-radius: 17rpx 17rpx 0rpx 0rpx;background: linear-gradient( 180deg, #C9FFD7 0%, #FFFFFF 20%, #FFFFFF 100%);" bind:close="renewCancel">
  <view class="renewBox">
    <view class="title">è®¢å•ç»­è´¹</view>
    <view class="line">
      <text class="bold">è®¢å•åŸç»“æŸæ—¶é—´</text>
      <text>{{OrderInfodata.endTime}}</text>
    </view>
    <view class="line">
      <text class="bold">ç»­è´¹åç»“æŸæ—¶é—´</text>
      <text>{{newTime}}</text>
    </view>
    <view class="mode-slot" bind:tap="modeChange">
      <view data-index="0" class="{{ modeIndex === 0 ? 'active' : '' }}">å°æ—¶ç»­è´¹</view>
      <view data-index="1" class="{{ modeIndex === 1 ? 'active' : '' }}">å¥—é¤ç»­è´¹</view>
    </view>
    <view wx:if="{{modeIndex === 0}}">
      <view class="line">
        <text class="bold">ç»­è´¹æ—¶é•¿ï¼š</text>
        <view class="time">
          <image bind:tap="onRenewMinus" src="../static/icon/minus.png" />
          <text>{{addTime || 0}} å°æ—¶</text>
          <image bind:tap="onRenewAdd" src="../static/icon/add.png" />
        </view>
      </view>
      <view class="line">
        <text class="bold">å°æ—¶å•ä»·ï¼š</text>
        <text class="bold">ï¿¥{{OrderInfodata.roomPrice}}/å°æ—¶</text>
      </view>
    </view>
    <view class="line" wx:if="{{modeIndex === 0}}">
      <label class="bold">ä¼˜æƒ å¡åˆ¸ï¼š</label>
      <view class="coupon" bindtap="goCoupon">
        <block wx:if="{{submit_couponInfo.couponName}}">
          <block wx:if="{{submit_couponInfo.type == 1}}">
            <view class="price-coupon">
              {{submit_couponInfo.couponName}}(æŠµæ‰£{{submit_couponInfo.price}}å°æ—¶)
            </view>
          </block>
          <block wx:if="{{submit_couponInfo.type == 2}}">
            <view class="price-coupon">
              {{submit_couponInfo.couponName}}(æ»¡å‡{{submit_couponInfo.price}}å…ƒ)
            </view>
          </block>
          <block wx:if="{{submit_couponInfo.type == 3}}">
            <view class="price-coupon">
              {{submit_couponInfo.couponName}}(å»¶é•¿{{submit_couponInfo.price}}å°æ—¶)
            </view>
          </block>
        </block>
        <block wx:else>
          <block wx:if="{{couponCount>0}}">
            <view class="price-coupon">{{couponCount}}å¼ </view>
          </block>
          <block wx:else>
            <view class="price-coupon">æš‚æ— </view>
          </block>
        </block>
      </view>
    </view>
    <scroll-view wx:if="{{modeIndex === 1 && pkgList.length>0}}" scroll-x class="mode" bindscroll="handleScroll" bindscrolltoupper="handleScrollStart">
      <view class="mode-container">
        <view class="item {{select_pkg_index == index?'active':''}}" bind:tap="selectPkgInfo" data-id="{{item.pkgId}}" wx:for="{{pkgList}}" wx:key="pkgList" data-index="{{index}}" data-hour="{{item.hours}}">
          <view class="top">
            <view class="left">
              <text class="pkgName">{{item.pkgName}}</text>
            </view>
            <text class="price">Â¥ {{item.price}}</text>
          </view>
          <view class="line"></view>
          <view class="bottom">{{item.desc}}</view>
          <view class="bottom">å¯ç”¨æ—¶æ®µï¼š{{item.timeQuantum}}</view>
          <view class="pkgInfo">
            <view class="bottom">{{item.balanceBuy?"å¯ä½™é¢æ”¯ä»˜":"ä¸æ”¯æŒä½™é¢æ”¯ä»˜"}}</view>
            <view class="bottom">{{item.enableHoliday?"èŠ‚å‡æ—¥å¯ç”¨":"èŠ‚å‡æ—¥ä¸å¯ç”¨"}}</view>
          </view>
        </view>
      </view>
    </scroll-view>
    <view class="progress" wx:if="{{modeIndex === 1 && pkgList.length>1}}">
      <view class="progress-marker" style="left: {{scrollPosition+'%'}}; width: {{(100 / pkgList.length)+'%'}}"></view>
    </view>
    <view class="divide-line"></view>
    <view class="section orderPrice orderPay">
      <view class="line">
        <text class="bold">æ”¯ä»˜æ–¹å¼ï¼š</text>
      </view>
      <radio-group class="line" style="margin-bottom: 20rpx;" bindchange="radioChange">
        <label class="pay" wx:for="{{payTypes}}" wx:key="value">
          <view class="left" data-index="1" wx:if="{{item.value == 1}}">
            <view class="item">
              <image src="../static/icon/wepay.png" />
              <text>å¾®ä¿¡</text>
            </view>
            <view class="selector {{payType == 1 && item.checked ? 'active':''}}"></view>
          </view>
          <view class="right-item" data-index="2" wx:if="{{item.value == 2}}">
            <iconfont name="yue" size="26"></iconfont>
            <view class="desc">
              <view>
                ä½™é¢ï¼š
                {{balance}}å…ƒ
              </view>
              <view>
                èµ é€ï¼š
                {{giftBalance}}å…ƒ
              </view>
            </view>
            <view class="selector {{payType == 2 && item.checked ? 'active':''}}"></view>
          </view>
          <radio style="opacity: 0;" value="{{item.value}}" checked="{{item.checked}}" />
        </label>
      </radio-group>
      <view class="line">
        <view class="btn" bind:tap="renewCancel">å–æ¶ˆ</view>
        <view class="btn active" bind:tap="SubmitOrderInfoData">ç¡®è®¤</view>
      </view>
    </view>
  </view>
</van-popup>